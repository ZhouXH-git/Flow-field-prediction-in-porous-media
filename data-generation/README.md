# Data generation for porous media flows
The data generation for porous media flows has two steps: (1) generating binary images of porous media and (2) simulating the single-phase flows though the porous media. 
## Binary images
In this work, we generate two types of 3D porous media: (1) fully packed porous media and (2) porous media with interior large vuggy pore space (i.e., cavity). The latter is designed to mimic the carbonate rocks which are rich in large fractures and vuggy pores and are highly relevant to hydrocarbon energy recovery in carbonate reservoirs.

- The **first** type of porous media can be easily generated by using the [open-source SpherePackTools package](https://github.com/JamesEMcClure/SpherePackTools) developed by Dr. James McClure. The process includes four steps:

1. manually modify the settings in ```pack.in``` (e.g., $N_s$, $\sigma^2$, $\phi_{\text {target}}$ ...);
2. run ```SpherePacking.cpp```, producing a file named ```pack.out```;
3. manually modify the settings in ```Digitize.in``` (e.g., $N_x$, $N_y$, $N_z$ ...);
4. run ```DigitizePacking.cpp```, producing the target file (e.g., ```pack80k_N100```), which is then used for flow simulation.

More details and examples can be found in ```SpherePackTools/doc/manual.pdf``` in James's GitHub.

- The **second** type of porous media is obtained based on the first type. We assume a large spherical pore space at the center of the porous medium and remove all grains (i.e., spheres) within this pore space. The code for removing the grains is provided in ```create_cavity.ipynb```.

Specifically, after the abovementioned step 2, we can run the ```create_cavity.ipynb``` to create an updated ```pack.out```, where the grains in the assumed large pore space are removed. The following steps 3 and 4 remain the same. Note that we need to keep the *updated* ```pack.out``` the same with the *original* ```pack.out``` in terms of the format (e.g., file header ...).

Here, we provide two examples: (1) a fully packed porous medium with the porosity $\phi_{\text {target}}=0.33$ and (2) a porous medium having large cavity inside. The latter is obtained by removing the central grains from a fully packed porous medium with the porosity $\phi_{\text {target}}=0.36$. The corresponding files and codes are organized in folders ```SphereTest_0.33``` and ```SphereTest_0.6_cavity```, respectively. The final digital files, ```pack_N512_33``` and ```pack_N512_36_cavity```, are not included in the folders due to the size limitation.

A cross-sectional view of the two different porous media is shown below and also in FIG. 1 in our [*PRFluids*](https://doi.org/10.1103/PhysRevFluids.7.074302) paper.

<div align=center><img width="750" src="https://github.com/xuhuizhou-vt/Flow-field-prediction-in-porous-media/blob/main/data-generation/with-without-cavity.png"/></div>

## Flow simulation

The single-phase porous media flows are simulated using the Lattice Boltzmann Method (LBM), which is performed with an [open-source solver---LBPM](https://github.com/OPM/LBPM/wiki/LBPM-Tutorial,-Step-3.-Single-Phase-Flow). Note that to achieve the same $Re$ number on different meshes, the driving force $F$ are set to be different with $F=1e-04$ on fine mesh and $F=6.4e-03$ on coarse mesh.

```
Domain {
   Filename =  "pack_N512_33"
   BC = 0   // periodic system
   ComponentLabels = 0
   N = 512, 512, 512   // 512 for fine; 128 for coarse
   ReadType = "8bit"
   ReadValues = 0, 1
   WriteValues = 0, 1
   n = 256, 256, 512
   nproc = 2, 2, 1  // 4 GPUs
   offset = 0, 0, 0
   voxel_length = 1.0
}
MRT {
   F = 0, 0, 1e-04   // 1e-04 for fine; 6.4e-03 for coarse
   tau = 1
   timestepMax = 100000
   tolerance = 0.00001
}
```




